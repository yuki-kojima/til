# 8/30

## AWS Lambda のコールドスタート
AWS Lambda が関数実行するために新しくインスタンスを立ち上げる必要がある状況のこと。
環境の初期化処理が必要なので、その実行時間分処理が完了するのが遅くなる。
（関数コードのDL、各種設定に基づいた環境作成）

このとき構築された実行環境は一定期間保持されるため、次に同じ関数に対するリクエストが来た場合には再利用するよう試みられる。そのため初回より処理時間は短くなる。これはウォームスタートという。
環境の保持期間は開発者は設定できない（保持期間は様々な要因を受けるらしい）

Lambda は複数の Availability Zones にまたがって関数実行管理するので、トラフィックの総量に応じて関数をロードバランスする可能性がある→短期間に同じ関数が複数回呼び出されても、それぞれの実行にコールドスタートが発生しうる

あとでもっと詳しく読む：https://aws.amazon.com/jp/blogs/news/operating-lambda-performance-optimization-part-1/


### 1リクエストに対して1インスタンスが対応が意味すること
AWS Lambda は1リクエストに対して1インスタンスが対応すると決まっている。そのリクエストに対する処理が終わると、同じ関数に対する次のリクエストを処理するために再利用される。
一定期間非アクティブなインスタンスは終了される。

# 8/31
AWS Builders Online アーカイブを見て

## オープニングセッション
- みてね（株式会社ミクシィ）の1秒動画は AWS の AI 技術を使っている
- AWS Skill Builder
  - https://aws.amazon.com/jp/training/digital/
  - 無料コースありの e-ラーニング

## 90分で学ぶ！AWS 超入門 2024 #1 - さぁ！AWS をはじめよう！ (Level 100) 

### AWS IAM
- AWS リソースのアクセス制御機能を提供
- IAM（アイアム）ポリシー：誰が何にアクセスできるかを定義。AWS が標準で用意しているものもある
  - AWS の各サービスごとに細かく権限が設定できる
- IAM ユーザー：IAM ユーザーに対してIAMポリシーを適用して権限を制御。複数作成可能（ルートユーザーが作成）

### ユーザーの種別
- ルートユーザー
  - メアド + パスワードでログイン
  - 全 AWS サービスとリソースに対して完全なアクセス権限がある（強い）
  - 日常タスクには使わない
- IAM ユーザー
 - アカウントID + IAM ユーザー名 + パスワードでログイン
 - IAM ポリシーで権限が付与された操作のみできる
 - 利用者ごとに IAM ユーザーでログインして作業


## 90分で学ぶ！AWS 超入門 2024 #2 - さぁ！AWS を使ってみよう！ (Level 100) 
### Amazon EC2
- 仮装サーバーを提供するサービス
- 数分で起動
- 多数OSサポート、ライセンス費用込みの従量課金
- 自由にソフトフェアをインストール可能
- リソース増や同じ設定の仮想サーバーの複製が簡単にできる

#### ハンズオンでやること
- ざっくりの構成: AWS アカウント > VPC(デフォルトで用意されている) > subnet(デフォルトで用意されている) > Security Group > EC2
- Security Group
 - ファイアーウォールみたいなもの
 - どのユーザの ssh を許すか、どこからのどのリクエストを許すかなどの設定をする
- ハンズオンでやること: ssh でアクセスし、セットアップ後ブラウザで HTTP 通信する

### Amazon VPC
- Virtual Private Cloud
- 専用の論理的に独立したネットワークを構築できるサービス
- IPアドレスとレンジ
  - 例: 10.0.0.0/16
  - /16 のレンジの数字は小さいほど、そのIPアドレスの空間が広いことを意味する？

#### ハンズオンでやること
- VPC の中に subnet を4つ作って使い分ける
- VPC の外からアクセスできる public 領域と private 領域に分ける（王道）
  - こっちにEC2を配置（ユーザーがアクセスできる）
- さらにそれぞれをアベイラビリティゾーンで分ける
  - こっちにDBを置く（ユーザーは直接アクセスできない。EC2経由でDBにアクセス）

- インターネットゲートウェイ
  - ？
- ルートテーブル
  - サブネットに紐づいている
  - 例えば EC2 から ssh でこの IP に接続して、という指示があったときに、どこに通信しに行くかを決める
    - 例えば、送信先: 10.0.0/16 ターゲット: local の場合、10.0.0/16の中の通信の場合は、VPCの中に通信しに行けば良いとわかる
    - 送信先: 0.0.0.0/0（VPC外） ターゲット: igw.hogehogehogehoge の場合、インターネットゲートウェイから外部に通信するべきとわかる


#### ハンズオンでやること
- パブリックサブネット内にweb用のサーバーを立てる（EC2）
- Security Group を作る（web-SGとする）
- WordPress をインストールする

### 単一障害点
- そこが止まったらシステム全てが止まってしまう部分
- AWS 設計時はこれをいかに無くしていくかを考えて設計することが大事

### そのほかの設計 tips 
- AWS Well Architected Framework を参照

## 90分で学ぶ！AWS 超入門 2024 #3 - さぁ！AWS を活用しよう！ (Level 100) 
- マネージドサービスと単一障害点がキーワード

#### ハンズオンでやること
- ブログデータを管理するDB を用意
- DB用の Security Group を作る（db-sg）
  - 条件として、web-sg がついている通信の mysql によるものだけ許可、とする
  - EC2 のサイドバーからセキュリティグループを作成できる
  - サブネットグループを指定する必要がある
  - サブネットグループは RDS で作成する。作成する際は private な方のサブネットを選ぶこと

### Amazon RDS
- マネージドなリレーショナルデータベースを提供
- コンソールから利用する機能を選択するだけでOK
- DB用の Security Group を作る（db-sg）
  - 条件として、web-sg がついている通信の mysql によるものだけ許可、とする
  - EC2 のサイドバーからセキュリティグループを作成できる
  - サブネットグループを指定する必要がある
    - RDS で作成する

### 単一障害点はないか？
- 今のままだと EC2 と RDS が単一障害点
- 今回のデモでは EC2 のみ対応する

### Elastic Load Balancing(ELB)
- 複数のターゲットにトラフィックを負荷分散するサービス
  - 複数のアベイラビリティゾーンにある複数のターゲットの中から正常なターゲットにのみ振り分ける
  - ヘルスチェックの結果、問題があるターゲットは切り離される
- 今回で言うとターゲットは EC2 インスタンス
- マネージドサービスのため管理不要
- ELB自体もスケーラブル（負荷に応じて自動でキャパシティを増減する）
  - 複数のパブリックサブネットにまたがって構築されるイメージ
- ターゲットグループを作成して指定する必要がある
  - 今回はターゲットグループは EC2 から作成する


#### ハンズオンでやること
- 概要：EC2 インスタンスを もう一つのパブリックサブネットにも作り、ELBを構築する
- ELB 用にも Security Group を作り、どこからのHTTPリクエストも受け付ける設定にする
- その代わり、EC2 の Security Group の方の設定は ELB の SG からのリクエストのみ許可する設定に変える
- その後、ロードバランサーを EC2 のコンソールから作成（Application Load Balancer）
- AMI を利用して EC2 を複製する